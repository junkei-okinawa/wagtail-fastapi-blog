# ğŸ¯ ã‚³ãƒ¼ãƒ‰å“è³ªç®¡ç†ã‚¬ã‚¤ãƒ‰

## ï¿½ æ®µéšçš„å“è³ªç®¡ç†ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€é–‹ç™ºåŠ¹ç‡ã¨å“è³ªã®ãƒãƒ©ãƒ³ã‚¹ã‚’å–ã‚‹ãŸã‚ã€æ®µéšçš„ãªå“è³ªç®¡ç†ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚

### **Level 1: ã‚³ã‚¢ã‚³ãƒ¼ãƒ‰ï¼ˆæœ€é«˜å“è³ªï¼‰**
```bash
# å¯¾è±¡: fastapi_app/, blog/, manage.py, main_asgi.py
make lint-core    # å³æ ¼ãƒã‚§ãƒƒã‚¯: flake8 + black + ruff (RUF005, RUF012ç­‰)
make test-unit    # é«˜é€Ÿå˜ä½“ãƒ†ã‚¹ãƒˆ
```
- **å“è³ªåŸºæº–**: RUF005 (ã‚¤ãƒ†ãƒ©ãƒ–ãƒ«ã‚¢ãƒ³ãƒ‘ãƒƒã‚¯)ã€RUF012 (ClassVar)ã€ç¾ä»£çš„Python
- **ã‚¨ãƒ©ãƒ¼æ™‚**: ãƒ“ãƒ«ãƒ‰åœæ­¢ï¼ˆå“è³ªã‚²ãƒ¼ãƒˆï¼‰
- **ç”¨é€”**: æ—¥å¸¸é–‹ç™ºã€æ©Ÿèƒ½å®Ÿè£…æ™‚

### **Level 2: çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆä¸­å“è³ªï¼‰**
```bash
# å¯¾è±¡: tests/unit/, tests/integration/
make lint-quick   # ruff + blackåŸºæœ¬ãƒã‚§ãƒƒã‚¯
make test-integration
```
- **å“è³ªåŸºæº–**: åŸºæœ¬ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã€importé †åº
- **ã‚¨ãƒ©ãƒ¼æ™‚**: ä¿®æ­£æ¨å¥¨
- **ç”¨é€”**: ãƒ†ã‚¹ãƒˆé–‹ç™ºã€CI

### **Level 3: E2Eãƒ†ã‚¹ãƒˆï¼ˆåŸºæœ¬å“è³ªï¼‰**
```bash
# å¯¾è±¡: tests/e2e/
make lint-e2e     # ç·©å’Œãƒã‚§ãƒƒã‚¯ï¼ˆéãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°è­¦å‘Šï¼‰
make test-e2e     # æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
```
- **å“è³ªåŸºæº–**: å®Ÿè¡Œã‚¨ãƒ©ãƒ¼é˜²æ­¢ã€æœ€ä½é™ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
- **ã‚¨ãƒ©ãƒ¼æ™‚**: è­¦å‘Šã®ã¿ï¼ˆãƒ“ãƒ«ãƒ‰ç¶™ç¶šï¼‰
- **ç”¨é€”**: E2Eä¿®æ­£æ™‚

## ğŸš€ å®Ÿè£…æ¸ˆã¿ã‚³ãƒãƒ³ãƒ‰ä½“ç³»

### **æ®µéšçš„å“è³ªãƒã‚§ãƒƒã‚¯**
| **ã‚³ãƒãƒ³ãƒ‰** | **ç”¨é€”** | **å®Ÿè¡Œæ™‚é–“** | **ä½¿ç”¨å ´é¢** |
|-------------|---------|-------------|-------------|
| `make lint-quick` | ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å“è³ªç¢ºèª | 5-10ç§’ | ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ä¸­ |
| `make lint-core` | ã‚³ã‚¢ã‚³ãƒ¼ãƒ‰å³æ ¼ãƒã‚§ãƒƒã‚¯ | 15-30ç§’ | æ©Ÿèƒ½å®Ÿè£…æ™‚ |
| `make lint` | å®Œå…¨å“è³ªãƒã‚§ãƒƒã‚¯ | 1-2åˆ† | ã‚³ãƒŸãƒƒãƒˆå‰ |
| `make lint-full` | çµ±åˆå“è³ªãƒã‚§ãƒƒã‚¯ | 2-3åˆ† | ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‰ |
| `make lint-e2e` | E2Eç·©å’Œãƒã‚§ãƒƒã‚¯ | 30ç§’ | E2Eä¿®æ­£æ™‚ |
| `make audit` | ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ» | 30ç§’-1åˆ† | é€±æ¬¡ãƒ»ä¾å­˜é–¢ä¿‚æ›´æ–°æ™‚ |

### **å®Ÿè£…æ¸ˆã¿Makefileã‚³ãƒãƒ³ãƒ‰è©³ç´°**
```makefile
# æ—¥å¸¸é–‹ç™ºï¼ˆé«˜é€Ÿãƒ»å³æ ¼ï¼‰
lint-core:
	uv run flake8 fastapi_app/ blog/ main_asgi.py manage.py --max-line-length=88 --extend-ignore=E203,E501,E402
	uv run black --check fastapi_app/ blog/ main_asgi.py manage.py

# ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç¢ºèªï¼ˆé«˜é€Ÿãƒ»åŸºæœ¬ï¼‰
lint-quick:
	uv run ruff check fastapi_app/ blog/ tests/unit/ tests/integration/ --fix || echo "Core lint issues detected"
	uv run black --check fastapi_app/ blog/ tests/unit/ tests/integration/

# å®Œå…¨å“è³ªãƒã‚§ãƒƒã‚¯ï¼ˆpre-commitå…¨å®Ÿè¡Œï¼‰
lint:
	uv run pre-commit run --all-files

# çµ±åˆãƒã‚§ãƒƒã‚¯ï¼ˆE2Eå«ã‚€ãƒ»ãƒªãƒªãƒ¼ã‚¹å‰ï¼‰
lint-full: lint lint-e2e
	@echo "âœ… Complete quality check passed"

# E2Eç·©å’Œãƒã‚§ãƒƒã‚¯ï¼ˆéãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°ï¼‰
lint-e2e:
	uv run black tests/e2e/ || echo "E2E formatting issues detected but not blocking"
	uv run flake8 tests/e2e/ --extend-ignore=E231,E272,E702,E202,E201,E221,E203,E501 || echo "E2E style issues detected but not blocking"

# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»
audit:
	uv run pip-audit
```

## ğŸ’¡ æ¨å¥¨é–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

### **1. æ—¥å¸¸é–‹ç™º** ğŸ”„
```bash
# ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å“è³ªç¢ºèªï¼ˆæ•°ç§’ï¼‰
make lint-quick && make test-unit

# ã‚³ã‚¢ã‚³ãƒ¼ãƒ‰å“è³ªç¢ºä¿ï¼ˆ10-20ç§’ï¼‰
make lint-core
```

### **2. æ©Ÿèƒ½å®Œæˆæ™‚** âœ…
```bash
# å®Œå…¨å“è³ªãƒã‚§ãƒƒã‚¯ï¼ˆ1-2åˆ†ï¼‰
make lint && make test

# ã‚«ãƒãƒ¬ãƒƒã‚¸ç¢ºèª
make test-coverage
```

### **3. ã‚³ãƒŸãƒƒãƒˆå‰** ğŸš€
```bash
# çµ±åˆå“è³ªãƒã‚§ãƒƒã‚¯ï¼ˆ2-3åˆ†ï¼‰
make lint && make test

# è‡ªå‹•å“è³ªãƒã‚§ãƒƒã‚¯ï¼ˆpre-commitè‡ªå‹•å®Ÿè¡Œï¼‰
git add .
git commit -m "feat: æ–°æ©Ÿèƒ½å®Ÿè£…"
```

### **4. ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‰** ğŸ“¦
```bash
# æœ€çµ‚å“è³ªã‚²ãƒ¼ãƒˆ
make lint-full && make test-coverage && make audit

# å¿…è¦ã«å¿œã˜ã¦E2Eãƒ†ã‚¹ãƒˆ
make test-e2e
```

## ï¿½ ãƒ„ãƒ¼ãƒ«è¨­å®šè©³ç´°

### **è¨­å®šçµ±ä¸€çŠ¶æ³**
- **line-length**: 88æ–‡å­— (å…¨ãƒ„ãƒ¼ãƒ«çµ±ä¸€)
- **ignore rules**: E501, E203, E402, F403, F405 (å…¨ãƒ„ãƒ¼ãƒ«çµ±ä¸€)
- **exclude patterns**: migrations, __pycache__, tests/e2e/ ãªã©

### **Pre-commitè¨­å®šå†…å®¹**
1. **trailing-whitespace**: è¡Œæœ«ç©ºç™½å‰Šé™¤
2. **end-of-file-fixer**: ãƒ•ã‚¡ã‚¤ãƒ«æœ«å°¾æ”¹è¡Œçµ±ä¸€
3. **check-yaml**: YAMLæ–‡æ³•ãƒã‚§ãƒƒã‚¯
4. **check-added-large-files**: å¤§ããªãƒ•ã‚¡ã‚¤ãƒ«æ¤œå‡º
5. **check-merge-conflicts**: ãƒãƒ¼ã‚¸ç«¶åˆæ¤œå‡º
6. **debug-statements**: ãƒ‡ãƒãƒƒã‚°æ–‡æ¤œå‡º
7. **black**: ã‚³ãƒ¼ãƒ‰æ•´å½¢
8. **isort**: importæ•´ç†
9. **flake8**: æ§‹æ–‡ãƒã‚§ãƒƒã‚¯
10. **pytest-quick**: é«˜é€Ÿãƒ†ã‚¹ãƒˆ (unit + integration)

### **å“è³ªåŸºæº–è©³ç´°**

#### **ã‚³ã‚¢ã‚³ãƒ¼ãƒ‰å“è³ªåŸºæº– (å³æ ¼)**
- **RUF005**: ã‚¤ãƒ†ãƒ©ãƒ–ãƒ«ã‚¢ãƒ³ãƒ‘ãƒƒã‚¯æ¨å¥¨ (`[*list1, item1]`)
- **RUF012**: Mutableã‚¯ãƒ©ã‚¹å±æ€§ã®`typing.ClassVar`ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
- **E501/E203**: è¡Œé•·ãƒ»ç©ºç™½ã¯blackã«å§”ä»»
- **F403/F405**: Django settingsç­‰ã®å¿…è¦ãªç®‡æ‰€ã§è¨±å¯
- **Importé †åº**: isortã«ã‚ˆã‚‹è‡ªå‹•æ•´ç†

#### **E2Eå“è³ªåŸºæº– (ç·©å’Œ)**
- **åŸºæœ¬ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ**: blackã«ã‚ˆã‚‹æœ€ä½é™æ•´å½¢
- **import/styleè­¦å‘Š**: éãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°ï¼ˆè­¦å‘Šã®ã¿ï¼‰
- **ãƒ—ãƒ©ã‚°ãƒ**: ãƒ†ã‚¹ãƒˆç‰¹åŒ–ã®æŸ”è»Ÿæ€§ã‚’è¨±å¯

## ğŸ“Š å®Ÿè£…æˆæœãƒ»é‹ç”¨åŠ¹æœ

### **å“è³ªå‘ä¸Šå®Ÿç¸¾**
- âœ… **RUF005/RUF012**: ç¾ä»£çš„Pythonã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ï¼ˆ`blog/models.py`ç­‰ï¼‰
- âœ… **Importæœ€é©åŒ–**: æœªä½¿ç”¨importå‰Šé™¤ï¼ˆ`schemas/*.py`ï¼‰
- âœ… **è¨­å®šçµ±ä¸€**: pyproject.tomlå“è³ªè¨­å®šé›†ç´„
- âœ… **æ®µéšçš„ãƒã‚§ãƒƒã‚¯**: é–‹ç™ºåŠ¹ç‡ã¨å“è³ªã®ãƒãƒ©ãƒ³ã‚¹

### **ãƒ„ãƒ¼ãƒ«è¨­å®šå®Œäº†**
- âœ… **Pre-commit**: å…¨è‡ªå‹•å“è³ªã‚²ãƒ¼ãƒˆ
- âœ… **Ruffç¾ä»£åŒ–**: æœ€æ–°lintè¨­å®šå½¢å¼
- âœ… **Black/isort/flake8**: çµ±ä¸€line-length=88
- âœ… **E2Eé™¤å¤–**: éãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°è­¦å‘Šã‚·ã‚¹ãƒ†ãƒ 

### **é‹ç”¨åŠ¹æœ**
- ğŸ“ˆ **é–‹ç™ºåŠ¹ç‡**: æ—¥å¸¸ã®é«˜é€Ÿãƒã‚§ãƒƒã‚¯ï¼ˆ`lint-quick`ï¼‰
- ğŸ›¡ï¸ **å“è³ªä¿è¨¼**: ãƒªãƒªãƒ¼ã‚¹å‰ã®å³æ ¼ãƒã‚§ãƒƒã‚¯ï¼ˆ`lint-full`ï¼‰
- âš–ï¸ **ãƒãƒ©ãƒ³ã‚¹**: å³æ ¼ã•ã¨å®Ÿç”¨æ€§ã®ä¸¡ç«‹
- ğŸ”„ **ç¶™ç¶šæ€§**: é•·æœŸé‹ç”¨å¯èƒ½ãªè¨­è¨ˆ

## ğŸ› ï¸ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### **ã‚ˆãã‚ã‚‹å“è³ªã‚¨ãƒ©ãƒ¼ã¨è§£æ±ºæ–¹æ³•**

#### **1. RUF005 (ã‚¤ãƒ†ãƒ©ãƒ–ãƒ«ã‚¢ãƒ³ãƒ‘ãƒƒã‚¯)**
```python
# âŒ å¤ã„æ›¸ãæ–¹
content_panels = Page.content_panels + [FieldPanel("intro")]

# âœ… ç¾ä»£çš„ãªæ›¸ãæ–¹
content_panels = [*Page.content_panels, FieldPanel("intro")]
```

#### **2. RUF012 (ClassVar)**
```python
# âŒ è­¦å‘ŠãŒå‡ºã‚‹æ›¸ãæ–¹
class MyModel(Page):
    subpage_types = ["app.MyPage"]

# âœ… å‹ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ã
class MyModel(Page):
    subpage_types: ClassVar[list[str]] = ["app.MyPage"]
```

#### **3. Importé †åº (isort)**
```python
# âœ… è‡ªå‹•ä¿®æ­£
make format

# ã¾ãŸã¯æ‰‹å‹•å®Ÿè¡Œ
uv run isort fastapi_app/ blog/
```

#### **4. pre-commitã§ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´ã•ã‚ŒãŸå ´åˆ**
```bash
# ä¿®æ­£ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’å†ã‚³ãƒŸãƒƒãƒˆ
git add .
git commit -m "fix: å“è³ªä¿®æ­£é©ç”¨"
```

#### **5. å€‹åˆ¥ãƒ„ãƒ¼ãƒ«å®Ÿè¡Œï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰**
```bash
# å•é¡Œèª¿æŸ»
uv run black fastapi_app/
uv run ruff check fastapi_app/ --fix
uv run flake8 fastapi_app/
```

## ğŸ¯ åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### **é–‹ç™ºç’°å¢ƒæº–å‚™**
```bash
# 1. ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
make install

# 2. Pre-commit hooksè¨­å®š
make setup-hooks

# 3. åˆå›å“è³ªãƒã‚§ãƒƒã‚¯
make lint

# 4. ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
make test
```

### **æ—¥å¸¸é–‹ç™ºã®å§‹ã‚æ–¹**
```bash
# ãƒ–ãƒ©ãƒ³ãƒä½œæˆ
git checkout -b feature/new-feature

# é–‹ç™ºç’°å¢ƒç¢ºèª
make dev

# å“è³ªãƒã‚§ãƒƒã‚¯ï¼ˆç¿’æ…£åŒ–ï¼‰
make lint-quick && make test-unit
```

ã“ã®çµ±åˆã«ã‚ˆã‚Šã€é–‹ç™ºè€…ã¯1ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§å“è³ªç®¡ç†ã®å…¨ã¦ã‚’ç†è§£ã§ãã€åŠ¹ç‡çš„ãªé–‹ç™ºãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚
